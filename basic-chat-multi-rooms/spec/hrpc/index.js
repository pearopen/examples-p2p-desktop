// This file is autogenerated by the hrpc compiler
/* eslint-disable camelcase */
/* eslint-disable space-before-function-paren */

import { c, RPC, RPCStream, RPCRequestStream } from 'hrpc/runtime'
import { getEncoding } from './messages.js'

const methods = new Map([
  ['@basic-chat-multi-rooms/rooms', 0],
  [0, '@basic-chat-multi-rooms/rooms'],
  ['@basic-chat-multi-rooms/add-room', 1],
  [1, '@basic-chat-multi-rooms/add-room'],
  ['@basic-chat-multi-rooms/join-room', 2],
  [2, '@basic-chat-multi-rooms/join-room'],
  ['@basic-chat-multi-rooms/messages', 3],
  [3, '@basic-chat-multi-rooms/messages'],
  ['@basic-chat-multi-rooms/add-message', 4],
  [4, '@basic-chat-multi-rooms/add-message']
])

class HRPC {
  constructor(stream) {
    this._stream = stream
    this._handlers = []
    this._requestEncodings = new Map([
      ['@basic-chat-multi-rooms/rooms', getEncoding('@basic-chat-multi-rooms/rooms')],
      ['@basic-chat-multi-rooms/add-room', c.string],
      ['@basic-chat-multi-rooms/join-room', c.string],
      ['@basic-chat-multi-rooms/messages', getEncoding('@basic-chat-multi-rooms/get-messages')],
      ['@basic-chat-multi-rooms/add-message', getEncoding('@basic-chat-multi-rooms/add-message')]
    ])
    this._responseEncodings = new Map([
    ])
    this._rpc = new RPC(stream, async (req) => {
      const command = methods.get(req.command)
      const responseEncoding = this._responseEncodings.get(command)
      const requestEncoding = this._requestEncodings.get(command)
      if (this._requestIsSend(command)) {
        const request = req.data ? c.decode(requestEncoding, req.data) : null
        await this._handlers[command](request)
        return
      }
      if (!this._requestIsStream(command) && !this._responseIsStream(command)) {
        const request = req.data ? c.decode(requestEncoding, req.data) : null
        const response = await this._handlers[command](request)
        req.reply(c.encode(responseEncoding, response))
      }
      if (!this._requestIsStream(command) && this._responseIsStream(command)) {
        const request = req.data ? c.decode(requestEncoding, req.data) : null
        const responseStream = new RPCStream(
          null,
          null,
          req.createResponseStream(),
          responseEncoding
        )
        responseStream.data = request
        await this._handlers[command](responseStream)
      }
      if (this._requestIsStream(command) && !this._responseIsStream(command)) {
        const requestStream = new RPCRequestStream(
          req,
          responseEncoding,
          req.createRequestStream(),
          requestEncoding
        )
        const response = await this._handlers[command](requestStream)
        req.reply(c.encode(responseEncoding, response))
      }
      if (this._requestIsStream(command) && this._responseIsStream(command)) {
        const requestStream = new RPCRequestStream(
          req,
          responseEncoding,
          req.createRequestStream(),
          requestEncoding,
          req.createResponseStream(),
          responseEncoding
        )
        await this._handlers[command](requestStream)
      }
    })
  }

  async _call(name, args) {
    const requestEncoding = this._requestEncodings.get(name)
    const responseEncoding = this._responseEncodings.get(name)
    const request = this._rpc.request(methods.get(name))
    const encoded = c.encode(requestEncoding, args)
    request.send(encoded)
    return c.decode(responseEncoding, await request.reply())
  }

  _callSync(name, args) {
    const requestEncoding = this._requestEncodings.get(name)
    const responseEncoding = this._responseEncodings.get(name)
    if (this._requestIsSend(name)) {
      const encoded = c.encode(requestEncoding, args)
      const request = this._rpc.event(methods.get(name))
      request.send(encoded)
    }

    const request = this._rpc.request(methods.get(name))

    if (!this._requestIsStream(name) && this._responseIsStream(name)) {
      const encoded = c.encode(requestEncoding, args)
      request.send(encoded)
      return new RPCStream(request.createResponseStream(), responseEncoding)
    }
    if (this._requestIsStream(name) && !this._responseIsStream(name)) {
      return new RPCRequestStream(
        request,
        responseEncoding,
        null,
        null,
        request.createRequestStream(),
        requestEncoding
      )
    }
    if (this._requestIsStream(name) && this._responseIsStream(name)) {
      return new RPCRequestStream(
        request,
        responseEncoding,
        request.createResponseStream(),
        responseEncoding,
        request.createRequestStream(),
        requestEncoding
      )
    }
  }

  rooms(args) {
    return this._callSync('@basic-chat-multi-rooms/rooms', args)
  }

  addRoom(args) {
    return this._callSync('@basic-chat-multi-rooms/add-room', args)
  }

  joinRoom(args) {
    return this._callSync('@basic-chat-multi-rooms/join-room', args)
  }

  messages(args) {
    return this._callSync('@basic-chat-multi-rooms/messages', args)
  }

  addMessage(args) {
    return this._callSync('@basic-chat-multi-rooms/add-message', args)
  }

  onRooms(responseFn) {
    this._handlers['@basic-chat-multi-rooms/rooms'] = responseFn
  }

  onAddRoom(responseFn) {
    this._handlers['@basic-chat-multi-rooms/add-room'] = responseFn
  }

  onJoinRoom(responseFn) {
    this._handlers['@basic-chat-multi-rooms/join-room'] = responseFn
  }

  onMessages(responseFn) {
    this._handlers['@basic-chat-multi-rooms/messages'] = responseFn
  }

  onAddMessage(responseFn) {
    this._handlers['@basic-chat-multi-rooms/add-message'] = responseFn
  }

  _requestIsStream(command) {
    return [
    ].includes(command)
  }

  _responseIsStream(command) {
    return [
    ].includes(command)
  }

  // prettier-ignore-start
  _requestIsSend(command) {
    return [
      // prettier-ignore
      '@basic-chat-multi-rooms/rooms',
      '@basic-chat-multi-rooms/add-room',
      '@basic-chat-multi-rooms/join-room',
      '@basic-chat-multi-rooms/messages',
      '@basic-chat-multi-rooms/add-message'
    ].includes(command)
  }
}

export default HRPC
